<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Intégrer le système information geographique &mdash; openMairie - Guide du développeur v0.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="openMairie - Guide du développeur v0.0 documentation" href="../index.html" />
    <link rel="up" title="<no title>" href="index.html" />
    <link rel="next" title="Générateur" href="../generateur/index.html" />
    <link rel="prev" title="Importer des données en csv" href="import.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../generateur/index.html" title="Générateur"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="import.html" title="Importer des données en csv"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">openMairie - Guide du développeur v0.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="int-grer-le-syst-me-information-geographique">
<span id="sig"></span><h1>Intégrer le système information geographique<a class="headerlink" href="#int-grer-le-syst-me-information-geographique" title="Lien permanent vers ce titre">¶</a></h1>
<p>La plupart des applications openMairie sont géo localisables</p>
<p>Il a été choisi de géolocaliser les données en utilisant :</p>
<ul class="simple">
<li>postgresql et sa cartouche graphique postgis</li>
<li>openlayers pour afficher et mettre à jour des données graphiques</li>
</ul>
<p>Ce module est opérationnel avec la version 2.02 d&#8217;openCimetiere et openLayer
est implémenté dans openMairie_exemple 4.0.0.</p>
<p>Pour l&#8217;instant les  scripts d&#8217;intégration ne sont pas mis en place. Il le seront
dans la version 4.0.1 dans le répertoire /sig.</p>
<div class="section" id="les-scripts-sig">
<h2>Les scripts sig<a class="headerlink" href="#les-scripts-sig" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le répertoire sig, il y a 3 scripts :</p>
<blockquote>
<ul class="simple">
<li>tab_sig.php : affiche la carte suivant les parametres de nom_objet.sig.inc</li>
<li>form_sig.php : modifie le champ geometry de l&#8217;objet</li>
<li>delete_sig.php : supprime le contenu  du champ geometry</li>
</ul>
</blockquote>
<p>Il y a un repertoire map ou sont stockés les fichiers map utilisés par mapserver</p>
<p>Le fichier var.inc stocke les variables suivantes</p>
<div class="highlight-python"><pre>// chemin de la carte pour mapserver
$path_map="http://localhost/cgi-bin/mapserv?map=/var/www/
                  openmairie_cimetiere/sig/map/";

// polygon créé par défaut
$creation_polygon="POLYGON((0 0,0 0))";</pre>
</div>
<p>Le fichier style.css contient la css de l interface</p>
<p>Le lancement du sig se fait avec tab_sig.php sous la forme suivante :</p>
<p>/sig/tab_sig?idx=29&amp;obj=emplacement</p>
<p>où :</p>
<p>$idx est l&#8217; enregistrement ou modifier/ajouter/supprimer la geometry  dans le champ geom</p>
<p>$obj est la table ou la geometry doit etre modifiée : cimetiere, emplacement, voie, zone</p>
<p>ATTENTION, il ne peut etre saisi qu un enregistrement existant dans la table</p>
<p>Dans pgsql, il y a les parametres des affichages tab_sig.php</p>
<p>En effet, il s agit d&#8217;afficher pour chaque objet la partie (box) de la carte à afficher et
l&#8217;objet courant et le titre</p>
<p>exemple : objet concession :</p>
<p>L&#8217;objectif dans openCimetiere est de saisir d&#8217;un polygone geometrique
representant un emplacement en fonction de la zone</p>
<p>La procedure est la suivante :</p>
<p>-&gt; afficher une partie de la carte du cimetière (la zone de l&#8217;emplacement)</p>
<p>-&gt; dessiner un polygone représentant la géometrie de la concession saisie</p>
<p>-&gt; enregistrer la geometry (wkt) : form_sig.php ou supprimer : delete_sig</p>
<p>les paramétres sig sont dans sql/pgsql/emplacement.sig.inc:</p>
<div class="highlight-python"><pre>$fichier_map ="cimetiere.map";                      nom de la carte dans /map
$titre= "Emplacement ".$idx." - ";                  titre affiché
$texte="";                                          texte affiché
$aff="zone";                                        fond de carte
$class_map="bigmap";                                taille : smallmap pu bigmap
$sql_idgeom="select voie.zone from emplacement " .  Identifiant a afficher
    "inner join voie on emplacement.voie=voie.voie " .
        "inner join zone on zone.zone=voie.zone
        where emplacement.emplacement =".$idx;
// box et zone
$affiche='famille';                                 champ affiché sur  emplacement
$sql ="select ('cimetiere ' ||cimetierelib||'       selection du libelle et de la box
        zone '|| zonelib) as lib,box(zone.geom)
        as box  from zone inner join cimetiere
        on cimetiere.cimetiere=zone.cimetiere ";</pre>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est necessaire d(installer sur le serveur apache, mapserver.</p>
<p>Il faut aussi installer la cartouche postgis avec postgres</p>
<p>Les installations sous UBUNTU sont les suivantes</p>
<div class="highlight-python"><pre>* installer les paquets postgis
- postgis
- postgresql-8.3.postgis

* installer mapserver
Verifiez que les depots Universe et Multiverse font partie de vos sources de mise a jour.
installer les paquets suivants
(obligatoire)
- cgi-mapserver
- mapserver-bin
- mapserver-doc
(optionnel)
- php5-mapscript.
relancer apache  $  /etc/init.d/apache2 restart

*** Installation de la base opencimetiere avec postgis

* creer la base opencimetiere (si elle n'est pas deja creee)
* create language "plpgsql"
* executer (version postgis &lt;1.5) la requete lwpostgis.sql -&gt; fonction postgis
  ou executer (version postgis &gt;= 1.5) la requete /usr/share/postgresql/8.3/
                                                contrib/postgis-1.5/postgis.sql
* executer spatial_ref_sys .sql qui remplit la table de donnees spatial_ref_sys
* VERIFICATION : les tables suivantes sont presentes :
    * table geometry_columns : index des geometries (vide)
    * table spation_ref_sys : liste des references spatiales (3162 lignes environ)
* executer les scripts d'initialisation de la base opencimetiere
    * data/pgsql/init.sql
    * data/pgsql/initsig.sql
    * data/pgsql/initsig_data.sql (optionnel) jeu de donnees</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table des matières</a></h3>
            <ul>
<li><a class="reference external" href="">Intégrer le système information geographique</a><ul>
<li><a class="reference external" href="#les-scripts-sig">Les scripts sig</a></li>
<li><a class="reference external" href="#installation">Installation</a></li>
</ul>
</li>
</ul>

            <h4>Sujet précédent</h4>
            <p class="topless"><a href="import.html"
                                  title="Chapitre précédent">Importer des données en csv</a></p>
            <h4>Sujet suivant</h4>
            <p class="topless"><a href="../generateur/index.html"
                                  title="Chapitre suivant">Générateur</a></p>
            <h3>Cette page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/framework/sig.txt"
                     rel="nofollow">Montrer la source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Recherche rapide</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../generateur/index.html" title="Générateur"
             >suivant</a> |</li>
        <li class="right" >
          <a href="import.html" title="Importer des données en csv"
             >précédent</a> |</li>
        <li><a href="../index.html">openMairie - Guide du développeur v0.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, openMairie.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>